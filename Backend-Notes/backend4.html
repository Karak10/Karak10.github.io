<!DOCTYPE HTML>
<html lang="en-US">
<head>
<title> Page four of my backend notes</title>
<meta charset="UTF-8"> 

<link href="../CSS-JavaScript-External-Files/HTMLnotes.css" rel="stylesheet">
<style>
    .red{
        background-color: unset;
        color: red;
     }
    body{
        overflow-x: hidden;
        width: 100%;
    }
    .left {
        text-align: left;
    }

    iframe {
        width: 600px;
        height: 350px;
        border: 3px solid black;
        margin: 20px auto 20px auto;
        display: block;
    }
    .code10 {
    white-space: pre-wrap;
    background-color: lightgreen;
    overflow-wrap: break-word;
    }
    
    p {
    text-align:center;
    }
    h1 {
    text-align:center;
    }
    h2 {
    text-align:center;
    }
    h3 {
    text-align:center;
    }
    .c {
    background-color:lightgreen;
    }
    hr {
    width:100%;
    height:15px;
    background-color:black;
    color:black;
    border: black solid;
    }
    body {
    background-color:rgb(165, 235, 235);
    }
    span {
    background-color:lightgreen;
    }
    
    a:link {
    color: black;
    text-shadow: 1px 0px 1px black;
    
    }
    
    a:visited {
    color: black;
    text-shadow: 1px 0px 1px rgb(22, 22, 22);
    }
    
    a:hover {
    text-decoration: underline;
    color: red;
    text-shadow: 1px 0px 1px black;
    }
     
    img{
        display: block;
        margin: 20px auto 20px auto;
        border: 3px solid black;
        border-radius: 10px;
    }
     
.syntax div{
    padding: 10px 10px;
    background-color: rgba(255, 255, 255, 0.2);
    white-space: pre-wrap;
    border-left: 5px solid green;
    overflow-wrap: break-word;
    word-wrap: break-word;
}
.grey{
    color: grey; background-color: unset;
}

.brown{
    color: rgb(150, 60, 60); background-color: unset;
}
article header :is(h2,h1){
    border: 3px solid black;
    border-radius: 20px;
    width: fit-content;
    padding: 10px;
    margin: auto;
    background-color: #2d3436;
background-image: linear-gradient(315deg, #000000 0%, #2d3436 46%, #000000 80%);
    color: white;
    font-family: 'Luckiest Guy', cursive;
    max-width: 60%;
    user-select: none;

}
article header h1{
    font-size: 2em;
     background-color: #2d3436;
background-image: linear-gradient(315deg, #000000 0%, #2d3436 46%, #000000 80%);
}
li{
    all:revert
}
ul{
    all:revert
}

.content li{
    margin-top: 10px;
}
article section{
        background-color: rgba(255, 255, 255, 0.2);
        border: 2px solid black;
        width: 85%;
        padding: 30px 5%;
        margin: auto;
        margin-top: 50px;
    }
.w3-btn{
    background-color: green;
    color: white !important;
    text-decoration: none !important;
    padding: 3px;
    font-family: 'Luckiest Guy', cursive;    
    border-radius: 10px;
    text-shadow: none !important;
    font-weight: 10px;
}
.w3-btn:hover{
    text-decoration: none !important;
}
    </style> 
</head>
<body>

<hr>

    <header> 
    <h1> Page four of my backend notes </h1>
    </header>
    
<article id="start-of-page"> 
  
<div id="homepages">

    <h3>Home Pages:</h3>
   

</div>

<nav data-notes="backend" data-page="4">

</nav>

<h3>Informations included in this page:</h3>
 

<br>


</article>

<script src="../CSS-JavaScript-External-Files/nav.js"></script>
<hr>

<article id="one">
<br>
<header><h1>Introduction to Node.js</h1></header>

<section>
<header><h2>What is Node.js?</h2></header>
<ul>
    <li>Node.js is an open source server environment</li>
    <li>Node.js is free</li>
    <li>Node.js runs on various plaforms (Windows, Linux, Unix, Mac OS X, etc)</li>
    <li>Node.js uses JavaScript on the server</li>
</ul>
</section>

<section>
<header><h2>Why Node.js?</h2></header>
<p><strong>Node.js uses asynchronous programming!</strong></p>
<p>A common task for a web server can be to open a file on the server
and return the content to the client. Here is how PHP or ASP handles a file request:</p>

<ol>
    <li>Sends the task to the computer's file system</li>
    <li>Waits while the file system opens and reads the file</li>
    <li>Returns the content to the client</li>
    <li>Ready to handle the next request</li>
</ol>

<p>Here is how Node.js handles a file request:</p>

<ol>
    <li>Sends the task to the com[puter's file system</li>
    <li>Ready to handle the next request</li>
    <li>When the file system has opened and read the file, the server returns the content to the client</li>
</ol>

<p>Node.js eliminates the waiting, and simply continues with the next request.</p>

<p>Node.js runs single-threaded, non-blocking, asynchronously programming, which is
very memory efficient.</p>
</section>

<section>
<header><h2>What can Node.js Do?</h2></header>
<ul>
    <li>Node.js can generate dynamic page content</li>
    <li>Node.js can create, open, read, write, delete, and close files on the server</li>
    <li>Node.js can collect form data</li>
    <li>Node.js can add, delete, modify data in your database</li>
</ul>
</section>

<section>
<header><h2>What is a Node.js File?</h2></header>
<ul>
    <li>Node.js files contain tasks that will be executed on certain events</li>
    <li>A typical event is someone trying to access a port on the server</li>
    <li>Node.js files must be initiated on the server before having any effect</li>
    <li>Node.js files have the extensions ".js"</li>
</ul>
</section>

<br>
</article>

<hr>

<article id="two">
<br>
<header><h1>NodeJS Getting Started</h1></header>

<section>
<header><h2>Installing NodeJS</h2></header>
<p>The official Node.js website has installation instructions for Node.js: <a href="https://nodejs.org" target="_blank">https://nodejs.org</a></p>

<p>If you are using Ubuntu there is a chance node may already
have been installed with it, I'm not sure since I never checked,
try typing node --version in bash to find out. If it is not
installed then install it from the link above. While installing it you are given
the option to add node to the PATH variable automatically, so when
the installation is done you should be able to check your PATH variable
and see where node and npm are, so that you can then
add the location to the PATH variable of Ubuntu as well so that you can
access it in bash. You may also need to add an alias since bash requires you
to write the full name of the files, with the extensions, and so writing "node"
alone won't work. Lastly, if I remember correctly, npm has a ".cmd" extension,
so you won't be able to run it in bash. To run it in bash you need to se this
alias first: alias cmd='/mnt/c/Windows/System32/cmd.exe /c' so that you can then
set this alias for npm: alias nom='cmd .../npm.cmd'. I have talked more about
the path variable and how you can edit it in my python notes, in one of the first sections
when I explain how to install it and prepare it.</p>

<p>Once you have downloaded and installed Node.js on your computer, let's try to display "Hello World" in a web browser.
Create a Node.js file named "myfirst.js", and add the following code:</p>

<div class="syntax" name="NodeJS">var http = require('http');

http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/html'});
  res.end('Hello World!');
}).listen(8080);</div>

<P>The code tells the computer to write "Hello World!" if anyone (e.g. a web browser) tries to access your computer on port 8080.
Having a basic understanding of networking could be useful, I have talked
about some networking concepts in my computer science notes, and I have
explained what ports are. For the moment however you don't have
to understand everything about the code above, since this is just an
example and we will learn those stuff in more detail another time.</P>
</section>

<section>
<header><h2>How to initiate a Node.js File</h2></header>

<p>Node.js files must be initiated in the "Command Line Interface" program of your computer.
If you are on windows you can use cmd or PowerShell, but you could also download
Ubuntu to use bash if you want to, that's what I do.</p>

<p>The file you have just created must be initiated by Node.js before any action can take place.
Start your command line interface, write node myfirst.js and hit enter:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10</span>$ node myfirst.js</div>

<p>Now, your computer works as a server!<br><br>
If anyone tries to access your computer on port 8080, they will get a "Hello World!" message in return!</p>

<p>To check if it works, open your internet browser, and type in the address "127.0.0.1:8080". 
The "127.0.0.1" IP address is known as the localhost address, it's an ip address that will always point back
to your device, you can also try writing "localhost:8080" and this should also work the same way.</p>
</section>
</article>

<br>
<hr>
<br>
<article id="three">
<header><h1>NodeJS Modules</h1></header>

<section>
<header><h2>What are modules?</h2></header>

<p>Consider modules to be the same as JavaScript libraries.
<br><br>
A set of functions you want to include in your application.</p>

<p>Node.js has a set of built-in modules which you can use without any further installation.
<br><br>
Look at this <a href="https://www.w3schools.com/nodejs/ref_modules.asp" target="_blank">Built-in Modules Reference</a> for a complete list of modules.</p>

<p>To include a module, use the <strong>require()</strong> function with the name of the module:</p>

<div class='syntax' name="node">var http = require('http');</div>

<p>Now your application has access to the HTTP module, and is able to create a server:</p>

<div class='syntax' name="node">http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/html'});
  res.end('Hello World!');
}).listen(8080);</div>

</section>

<section>
<header><h2>Create Your Own Modules</h2></header>
<p>You can create your own modules, and easily include them in your applications.
<br><br>
The following example creates a module that returns a date and time object:</p>

<div class="syntax" name="node">exports.myDateTime = function(){
    return Date();
};</div>

<p>Use the exports keyword to make properties and methods available outside the module file.
Save the code above in a file called "myfirstmodule.js"</p>
</section>

<section>
<header><h2>Include Your Own Module</h2></header>
<p>Now you can include and use the module in any of your Node.js files.</p>

<div class="syntax" name="node">var http = require('http');
var dt = require('./myfirstmodule');

http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/html'});
  res.write("The date and time are currently: " + dt.myDateTime());
  res.end();
}).listen(8080);</div>

<p>Notice that we use ./ to locate the module, that means that the module is located in the same folder as the Node.js file.

Save the code above in a file called "demo_module.js", and initiate the file:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10</span>$ node demo_module.js</div>

<p>If you have followed the same steps on your computer, you will see the result at this address: http://localhost:8080</p>
</section>

</article>

<br><hr><br>

<article id="four">
<header><h1>NodeJS HTTP Module</h1></header>

<section>
<header><h2>NodeJS as a Web Server</h2></header>
<p>Node.js has a built-in module called HTTP, which allows Node.js to transfer data over the Hyper Text Transfer Protocol (HTTP).</p>
<p>To include the HTTP module, use the <Strong>require()</Strong> method:</p>
<div class="syntax" name="NodeJS">var http = require('http');</div>

<p>The HTTP module can create an HTTP server that listens to server ports and gives a response back to the client.
Use the <Strong>createServer()</Strong> method to create an HTTP server:</p>

<div class="syntax" name="NodeJS">var http = require('http');

<span class="grey">//create a server object:</span>
http.createServer(function (req, res) {
  res.write('Hello World!'); <span class="grey">//write a response to the client</span>
  res.end(); <span class="grey">//end the response</span>
}).listen(8080); <span class="grey">//the server object listens on port 8080</span></div>

<p>The function passed into the http.createServer() method, will be executed when someone tries to access the computer on port 8080.
Save the code above in a file called "demo_http.js", and initiate the file:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10</span>$ node demo_http.js</div>

<p>You can then see the results by visiting this address in your internet browser: http://localhost:8080</p>
</section>

<section>
<header><h2>Add an HTTP Header</h2></header>

<p>If the response from the HTTP server is supposed to be displayed as HTML, you should include an HTTP header with the correct content type:</p>

<div class="syntax" name="node">var http = require('http');
http.createServer(function (req, res) {
  <span class='red'>res.writeHead(200, {'Content-Type': 'text/html'});</span>
  res.write('Hello World!');
  res.end();
}).listen(8080);</div>

<p>The first argument of the <Strong>res.writeHead()</Strong> method is the status code, 200 means that all is OK<br><br>The second argument is an object containing the response headers.</p>

<p>You may wonder now, what is an HTTP header? And why do we even need it?
I think it's necessary that you have some basic understanding of what HTTP is and how it
works before learning NodeJS. Just learning how to do stuff without fully understanding them
isn't the right way to learn.</p>

<p>At first you may not see any difference when using the writeHead() method. To
see that what you did works,
open the dev tools and click "Network", then reload
the page so that the HTTP requests made when accessing the page appear.
Ignore the favicon.ico request, and click the one with the name "localhost",
at the right you should be able to see the Response Headers, that's where the
change between the two files should appear.</p>

<p>I have collected here 2 videos that you could watch to better
    understand HTTP and HTTPS. Firstly, here is a video that simplifies HTTPS
    so that you can have a clearer picture of what happens in the background:</p>
    
    <iframe width="1264" height="720" src="https://www.youtube.com/embed/T4Df5_cojAs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    
    <p>In the next video I am gonna share with you the guy goes over some HTTP concepts
    in more detail, so it's a little harder to undertand, it's bigger, but it
    explains a lot of useful stuff, and he talks about HTTP headers too:</p>
    <iframe width="1264" height="720" src="https://www.youtube.com/embed/iYM2zFP3Zn0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section>

<section>
<header><h2>Read the Query String</h2></header>
<p>The function passed into the <strong>http.createServer()</strong> has a <stron>req</stron> argument that represents the request from the client, as an object (http.IncomingMessage object).</p>
<p>This object has a property called "url" which holds the part of the url that comes after the domain name:</p>

<div class="syntax" name="node">var http = require('http');
http.createServer(function (<span class="red">req</span>, res) {
  res.writeHead(200, {'Content-Type': 'text/html'});
  res.write(<span class="red">req.url</span>);
  res.end();
}).listen(8080);</div>

<p>Save the code above in a file called "demo_http_url.js" and initiate the file:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10</span>$ node demo_http_url.js</div>

<p>Now, try visiting "localhost:8080/karak10" and "localhost:8080/christina",
if everything works correctly, when visiting the first address your page should
display "/karak10" while when visiting the second address your page should display
"/christina".</p>
</section>

<section>
<header><h2>Split the Query String</h2></header>
<p>There are built-in modules to easily split the query string into readable parts, such as the URL module.</p>

<div class="syntax" name="node">var http = require('http');
<span class="red">var url = require('url');</span>

http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/html'});
  <span class="red">var q = url.parse(req.url, true).query;</span>
  var txt = <span class="red">q.year</span> + " " + <span class="red">q.month</span>;
  res.end(txt);
}).listen(8080);</div>

<p>Now if you initiate this file and visit this address "localhost:8080/?year=2017&month=July"
then this should appear on your screen: 2017 July</p>

<p>We will talk more about the URL module another time so you don't need to fully understand the code above yet.</p>
</section>
</article>

<br><hr><br>

<article id="five">
<header><h1>NodeJS File System Module</h1></header>

<section>
<header><h2>NodeJS as a File Server</h2></header>

<p>The Node.js file system module allows you to work with the file system on your computer.
<br><br>
To include the File System module, use the require() method:</p>

<div class="syntax" name="node">var fs = require('fs');</div>

<p class="left">Common use for the File System module:</p>

<ul>
    <li>Read files</li>
    <li>Create files</li>
    <li>Update files</li>
    <li>Delete files</li>
    <li>Rename files</li>
</ul>
</section>

<section>
<header><h2>Read Files</h2></header>
<p>The fs.readFile() method is used to read files on your computer.
<br><br>
Assume we have the following HTML file (located in the same folder as Node.js):</p>

<div class="syntax" name="html">&lt;html>
&lt;head>
&lt;title>This is a title&lt;/title>
&lt;/head>
&lt;body>
&lt;h1>My Header&lt;/h1>
&lt;p>My paragraph.&lt;/p>
&lt;/body>
&lt;/html></div>

<p>We can create a Node.js file that reads the HTML file, and return the content:</p>

<div class="syntax" name="node">var http = require('http');
<span class="red">var fs = require('fs');</span>
http.createServer(function (req, res) {
  <span class="red">fs.readFile('demofile1.html', function(err, data) {</span>
    res.writeHead(200, {'Content-Type': 'text/html'});
    res.write(<span class="red">data</span>);
    return res.end();
  <span class="red">});</span>
}).listen(8080);</div>

<p>So, when you visit localhost:8080, the html file you created will now be used.</p>
<p>So, something I want to mention is that we return the res.end() method inside
the function we passed in readFile method. Why are we doing that? That's because
it takes time for the code inside readFile to run, since it has to retrieve data
from anothe file first. We didn't necessarily need to return the res.end() method,
we could just call it inside the function and it would still work.
What would happen if we wrote the res.end() method outside the function though?
The res.end() method would run slightly earlier than the function, and so we would get an error, since we cannot
use the res.write() method after he have used the res.end() method. The res.end() method
is supposed to end the response and send it to the browser.</p>

<p>In the future we may need to retrieve multiple files and stuff
so it may be necessary to use promises instead. Here is an example
of how the code would look with a promise:</p>

<div class="syntax" name="node">var http = require('http');
var fs = require('fs');
http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type':'text/html'});
  <span class="red">let promise = new Promise(function(resolve, reject){</span>
      fs.readFile('demofile1.html', function(err, data){
          res.write(data);
          <span class="red">resolve();</span>
      });
  <span class="red">});</span>
  <span class="red">promise.then(function(){</span>
      res.end();
  <span class="red">});</span>
}).listen(8080);</div>
</section>


</article>

<br><hr><br>

<article id="six">
<header><h1>NodeJS URL Module</h1></header>
<section>
<p>The URL module splits up a web address into readable parts.
<br><br>
To include the URL module, use the <strong>require()</strong> method:</p>

<div class="syntax" name="node">var url = require('url');</div>

<p>Parse an address with the url.parse() method, and it will return a URL object with each part of the address as properties:</p>

<div class="syntax" name="node">var url = require('url');
var adr = 'http://localhost:8080/default.htm?year=2017&month=february';
var q = url.parse(adr, true);

console.log(q.host); <span class="grey">//returns 'localhost:8080'</span>
console.log(q.pathname); <span class="grey">//returns '/default.htm'</span>
console.log(q.search); <span class="grey">//returns '?year=2017&month=february'</span>

var qdata = q.query; <span class="grey">//returns an object: { year: 2017, month: 'february' }</span>
console.log(q.data.month); <span class="grey">//returns 'february'</span></div>

<p class="left">This method accepts three parameters as described below:</p>

<ul>
    <li><strong>urlString</strong> - It holds the URL string which needs to parse.</li>
    <li><strong>parseQueryString</strong> - It is a boolean value. If set to true then the query property will be set to an object returned by the querystring module’s parse() method. If it set to false then the query property on the returned URL object will be an unparsed, undecoded string. Its default value is false.</li>
    <li><strong>slashesDenoteHost</strong> - It is a boolean value. If it set to true then the first token after the literal string // and preceding the next / will be interpreted as the host. For example: //geeksforgeeks.org/web-technology contains the result {host: ‘geeksforgeeks.org’, pathname: ‘/web-technology’} rather than {pathname: ‘//geeksforgeeks.org/web-technology’}. Its default value is false.</li>
</ul>
</section>

<section>
<header><h2>NodeJS File Server</h2></header>
<P>Now we know how to parse the query string, and in the previous chapter we learned how to make Node.js behave as a file server. Let us combine the two, and serve the file requested by the client.
<br><br>
Create two html files and save them in the same folder as your node.js files.</P>

<div class="syntax" name="summer.html">&lt;!DOCTYPE html>
&lt;html>
&lt;body>
&lt;h1>Summer&lt;/h1>
&lt;p>I love the sun!&lt;/p>
&lt;/body>
&lt;/html></div>
<br>
<div class="syntax" name="winter.html">&lt;!DOCTYPE html>
&lt;html>
&lt;body>
&lt;h1>Winter&lt;/h1>
&lt;p>I love the snow!&lt;/p>
&lt;/body>
&lt;/html></div>

<p>Create a Node.js file that opens the requested file and returns the content to the client. If anything goes wrong, throw a 404 error:</p>

<div class="syntax" name="node" style="word-spacing: 3px;">var http = require('http');
var url = require('url');
var fs = require('fs');

http.createServer(function (req, res) {
  var q = url.parse(req.url, true);
  var filename = "." + q.pathname;
  fs.readFile(filename, function(err, data) {
    if (err) {
      res.writeHead(404, {'Content-Type': 'text/html'});
      return res.end("404 Not Found");
    } 
    res.writeHead(200, {'Content-Type': 'text/html'});
    res.write(data);
    return res.end();
  });
}).listen(8080);</div>

<p>Remember to initiate the file:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10</span>$ node demo_fileserver.js</div>

<p>If you have followed the same steps on your computer, you should see two different results when opening these two addresses:</p>

<ul>
    <li><a href="http://localhost:8080/summer.html" target="_blank">http://localhost:8080/summer.html</a></li>
    <li><a href="http://localhost:8080/winter.html" target="_blank">http://localhost:8080/winter.html</a></li>
</ul>
</section>
<br>
</article>

<br><hr><br>

<article id="seven">
<header><h1>NodeJS Events</h1></header>

<section>
<p>Node.js is perfect for event-driven applications.</p>
<p>Every action on a computer is an event. Like when a connection is made or a file is opened.
<br><br>
Objects in Node.js can fire events, like the readStream object fires events when opening and closing a file:</p>

<div class="syntax" name="node">var fs = require('fs');
var rs = fs.createReadStream('./demofile.txt');
rs.on('open', function () {
  console.log('The file is open');
});</div>

<p>Let's go step by step so we can understand what's going on with the code and how Node.js works.
<br><br>
First we import the filesystem module into our code.
Then we are using the createReadStream method from fs to create a readable stream object. You can
learn more about what a stream is in the video bellow:

<iframe width="1264" height="720" src="https://www.youtube.com/embed/GlybFFMXXmQ?list=PL4cUxeGkcC9gcy9lrvMJ75z9maRw4byYp" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Anyway, Node.js is event-driven. It means that you can know when something is done. In our case, we are listening to the event 'open' so whenever ReadStream opens the file it will let us know. The 'open' event doesn't mean that you need to open the file manually.</p>

<p>I may talk more about the createReadStream method
in the future, this section is about events, and createReadStream is just
an example I used, don't let it confuse you. Just like how images, audio and
document elements have events a read stream object can as well have events, this is
nothing new actually if you know JavaScript you should already be familiar with events. Only new thing we learn here is
the createReadStream method, which creates a ReadStream object, but it's not necessary to fully understand it yet,
for now here is a video that explains the method a little better:
</p>

<iframe width="1264" height="720" src="https://www.youtube.com/embed/E3tTzx0Qoj0?list=PL4cUxeGkcC9gcy9lrvMJ75z9maRw4byYp" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section>

<section>
<header><h2>The EventEmitter Object</h2></header>
<p>You can assign event handlers to your own events with the EventEmitter object.
<br><br>
In the example below we have created a function that will be executed when a "scream" event is fired.
<br><br>
To fire an event, use the emit() method.</p>

<div class="syntax" name="node">var events = require('events');
var eventEmitter = new events.EventEmitter();

<span class="grey">//Create an event handler:</span>
var myEventHandler = function () {
  console.log('I hear a scream!');
}

<span class="grey">//Assign the event handler to an event:</span>
eventEmitter.on('scream', myEventHandler);

<span class="grey">//Fire the 'scream' event:</span>
eventEmitter.emit('scream');</div>

<p>So, EventEmitter is a class inside the events object, which you use to create
a new object from that class. You can then use the object to set and emit events.</p>

<p>Let's try making this more interesting by using it together with a module called util, which
has a method that allows a constructor to inherit methods from another class or function.</p>

<div class="syntax" name="noed">var events = require('events');
var util = require('util');

let createPerson = class{
    constructor(name){
        this.name = name;
    }
}

util.inherit(createPerson, events.EventEmitter);

let person1 = new createPerson('Alex');
let person2 = new createPerson('Karak10')
let person3 = new createPerson('Kektaran');

let people = [person1, person2, person3];

people.forEach(function(person)=>{
    person.on('speak', function(msg){
        console.log(person.name + ' said ' + msg);
    })
});

person1.emite('speak', 'Karak10 is so stupid')
person2.emite('speak', 'Kektaran is so antisocial')
person3.emite('speak', 'Alex is so lazy')</div>

<P>Here is a video that talks about events:</P>
<iframe width="1264" height="720" src="https://www.youtube.com/embed/NtrnaTKqFPQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section>
</article>

<br><hr><br>

<article id='eight'>
<header><h1>NodeJS Upload Files</h1></header>

<section>
<header><h2>The Formidable Module</h2></header>
<p>There is a very good module for working with file uploads, called "Formidable".
<br><br>
The Formidable module can be downloaded and installed using NPM:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10/Desktop/my_project</span>$ npm init -y
Wrote to C:\Users/karak10/Desktop/my_project\package.json:

{
  "name": "desktop",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}

<span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10/Desktop/my_project</span>$ npm install formidable</div>

<p>After you have downloaded the Formidable module, you can include the module in any application:</p>

<div class="syntax" name="node">var formidable = require('formidable');</div>


</section>

<section>
<header><h2>Step 1: Create an Upload Form</h2></header>
<p>Now you are ready to make a web page in Node.js that lets the user upload files to your computer:</p>

<p>Create a Node.js file that writes an HTML form, with an upload field:</p>

<div class="syntax" name="node">var http = require('http');

http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/html'});
  res.write('&lt;form action="fileupload" method="post" enctype="multipart/form-data">');
  res.write('&lt;input type="file" name="filetoupload">&lt;br>');
  res.write('&lt;input type="submit">');
  res.write('&lt;/form>');
  return res.end();
}).listen(8080);</div>

<p>The <strong>method</strong> attribute specifies how to send form-data. The form-data is sent to the page specified in the <strong>action</strong> attribute.</p>

<dl style="margin-left: 10px">
    <dt><strong>Notes on GET:</strong></dt>
    <dd>
        <ul>
            <li>Appends form-data into the URL in name/value pairs</li>
            <li>The length of a URL is limited (about 3000 characters)</li>
            <li>Never use GET to send sensitive data! (will be visible in the URL)            </li>
            <li>Useful for form submissions where a user wants to bookmark the result</li>
            <li>GET is better for non-secure data, like query strings in Google</li>
        </ul>
    </dd>
    <dt><strong>Notes on POST:</strong></dt>
    <dd>
        <ul>
            <li>Appends form-data inside the body of the HTTP request (data is not shown in URL)</li>
            <li>Has no size limitations</li>
            <li>Form submissions with POST cannot be bookmarked</li>
        </ul>
    </dd>
</dl>

<p>The <strong>enctype</strong> attribute specifies how the form-data should be encoded when submitting it to the server.</p>

<table class="table" style="width: 60%">
    <tr>
        <th>Value</th>
        <th>Description</th>
    </tr>
    <tr>
        <td>application/x-www-form-urlencoded</td>
        <td>Default. All characters are encoded before sent (spaces are converted to "+" symbols, and special characters are converted to ASCII HEX values)</td>
    </tr>
    <tr>
        <td>multipart/form-data</td>
        <td>This value is necessary if the user will upload a file through the form</td>
    </tr>
    <tr>
        <td>text/plain</td>
        <td>Sends data without any encoding at all. Not recommended</td>
    </tr>
</table>

<p>The <Strong>enctype</Strong> attribute can be used only if <Strong>method="post"</Strong> is used.</p>

<p>The <Strong>name</Strong> attribute is used to reference elements in JavaScript, or to reference form data after a form is submitted.
Only form elements with a <strong>name</strong> attribute will have their values passed when submitting a form.</p>
</section>

<section>
<header><h2 class="left">Step 2: Parse the Uploaded File</h2></header>

<p>Include the Formidable module to be able to parse the uploaded file once it reaches the server.
<br><br>
When the file is uploaded and parsed, it gets placed on a temporary folder on your computer.</p>

<div class='syntax' name="node">var http = require('http');
var formidable = require('formidable');

http.createServer(function (req, res) {
  if (req.url == '/fileupload') {
    var form = new formidable.IncomingForm(); 
    form.parse(req, function (err, fields, files) { 
      res.write('File uploaded');
      res.end();
    });
  } else {
    res.writeHead(200, {'Content-Type': 'text/html'});
    res.write('&lt;form action="fileupload" method="post" enctype="multipart/form-data">');
    res.write('&lt;input type="file" name="filetoupload">&lt;br>');
    res.write('&lt;input type="submit">');
    res.write('&lt;/form>');
    return res.end();
  }
}).listen(8080);</div>

<p>So, I am pretty sure I mentioned perviously at some point that
req.url holds the part of the url that comes after the domain name.
When we sumbit the form, an HTTP request will be sent to the server
with localhost:8080/fileupload being it's destination. Like we
have done in previous examples we are using node to
respond to that request. In fact, we
are using the formidable module to parse the
data sent with the http request and
write a respond to be displayed on the page.</p>
</section>

<section>
<header><h2 class="left">Step 3: Move the File</h2></header>
<p>When a file is successfully uploaded to the server, it is placed on a temporary folder.
<br><br>
The path to this directory can be found in the "files" object, passed as the third argument in the parse() method's callback function.
<br><br>
To move the file to the folder of your choice, use the File System module, and rename the file:</p>

<div class="syntax" name="node">var http = require('http');
var formidable = require('formidable');
var fs = require('fs');

http.createServer(function (req, res) {
  if (req.url == '/fileupload') {
    var form = new formidable.IncomingForm();
    form.parse(req, function (err, fields, files) {
      var oldpath = files.filetoupload.filepath;
      var newpath = 'C:/Users/Your Name/' + files.filetoupload.originalFilename;
      fs.rename(oldpath, newpath, function (err) {
        if (err) throw err;
        res.write('File uploaded and moved!');
        res.end();
      });
 });
  } else {
    res.writeHead(200, {'Content-Type': 'text/html'});
    res.write('&lt;form action="fileupload" method="post" enctype="multipart/form-data">');
    res.write('&lt;input type="file" name="filetoupload">&lt;br>');
    res.write('&lt;input type="submit">');
    res.write('&lt;/form>');
    return res.end();
  }
}).listen(8080);</div>

<p>Don't let the code above confuse you. The <strong>fs.rename()</strong> method is 
used to asynchronously rename a file at the given old path to a 
given new path. It will overwrite the destination file if it already 
exists. So that's all the code really does,
it takes the path of where the file has been saved, and it changes that
file's path to a new path that can be anywhere you like, I recommend a
folder perhaps inside your project or something.</p>

<p>About the files and fields property, they can be used
to access files or fields inputs. As you can see
in the example I am accessing the file input with the name
"filetoupload", which name I had given the input inside
the html. Similarly we can access fields like the example bellow:</p>

<div class="syntax" name="node">var http = require('http');
var formidable = require ('formidable');
var fs = require('fs');

http.createServer(function(req, res){
  if(req.url == '/uploadfile'){
    let form = new formidable.IncomingForm();
    form.parse(req, function(err, fields, files){
      <span class="red">var reg = new RegExp(/\..*/, 'gi');
      var name = fields.filename + files.filetoupload.originalFilename.match(reg);</span>
      var oldPath = files.filetoupload.filepath;
      var newPath = 'C:/Users/fotis/Desktop/upload_files/files_folder/' + <span class="red">name</span>;
      fs.rename(oldPath, newPath, function(err){
        if(err){
          res.write('An error occured while uploading the file');
          res.end();
        } else {
          res.write('File uploaded and moved!');
          res.end();
        }
      })
    })
  } else {
    res.writeHead(200, {'Content-Type':'text/html'});
    res.write('&lt;form action="uploadfile" method="post" enctype="multipart/form-data">');
    res.write('&lt;input type="file" name="filetoupload" required>&lt;br>');
    <span class="red">res.write('&lt;label>Custom name:&lt;/lebel>&lt;input type="text" name="filename">&lt;br>');</span>
    res.write('&lt;input type="submit">');
    res.write('&lt;/form>');
    res.end();
  }
}).listen(5808);</div>

<p>In the example above I have made it so you can type a name for the file,
and to automatically add the extension of the image next to the name
I used regular expressions so that I can take the extension from
the original file's name.</p>
</section>


</article>

<hr>

<article id="nine">
<header><h1>NodeJS Sending an Email</h1></header>
<section>
<header><h2>The Nodemailer Module</h2></header>
<p>The Nodemailer module makes it easy to send emails from your computer.
<br><br>
The Nodemailer module can be downloaded and installed using npm:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10/Desktop/my_project</span>$ npm init -y
Wrote to C:\Users/karak10/Desktop/my_project\package.json:

{
  "name": "desktop",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}

<span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10/Desktop/my_project</span>$ npm install nodemailer</div>

<p>After you have downloaded the Nodemailer module, you can include the module in any application:</p>

<div class="syntax" name="node">var nodemailer = require('nodemailer');</div>
</section>

<section>
<header><h2>Send an Email</h2></header>

<p>Now you are ready to send emails from your server.
<br><br>
Use the username and password from your selected email provider to send an email. This example will show you how to use your Gmail account to send an email:</p>

<div class="syntax" name="node">var nodemailer = require('nodemailer');

var transporter = nodemailer.createTransport({
  service: 'gmail',
  auth: {
    user: 'youremail@gmail.com',
    pass: 'yourpassword'
  }
});

var mailOptions = {
  from: 'youremail@gmail.com',
  to: 'myfriend@yahoo.com',
  subject: 'Sending Email using Node.js',
  text: 'That was easy!'
};

transporter.sendMail(mailOptions, function(error, info){
  if (error) {
    console.log(error);
  } else {
    console.log('Email sent: ' + info.response);
  }
});</div>

<p>And that's it! Now your server is able to send emails. Of course this
module can be used while responding to HTTP requests too. Which means, if you use
the formidable module as well you can do pretty cool things with this.</p>
</section>

<section>
<header><h2>Multiple Receivers</h2></header>
<p>To send an email to more than one receiver, add them to the "to" property of the mailOptions object, separated by commas:</p>
<div class="syntax" name="node">var mailOptions = {
  from: 'youremail@gmail.com',
  to: 'myfriend@yahoo.com, myotherfriend@yahoo.com',
  subject: 'Sending Email using Node.js',
  text: 'That was easy!'
}</div>
</section>

<section>
<header><h2>Send HTML</h2></header>
<p>To send HTML formatted text in your email, use the "html" property instead of the "text" property:</p>
<div class="syntax" name="node">var mailOptions = {
  from: 'youremail@gmail.com',
  to: 'myfriend@yahoo.com',
  subject: 'Sending Email using Node.js',
  html: '&lt;h1>Welcome&lt;/h1>&lt;p>That was easy!&lt;/p>'
}</div>
</section>

</article>

<hr>

<article id="ten">
<header><h1>NodeJS MySQL</h1></header>

<section>

<header><h2>MySQL Database</h2></header>
<p>Node.js can be used in database applications.
<br><br>
One of the most popular databases is MySQL.</p>

<p>To be able to experiment with the code examples, you should have MySQL installed on your computer.
<br><Br>
I have written about MySQL a lot more in previous notes I have kept, so you can find more about
how to install it and use it here: <a href="backend1.html" target="_blank">backend1.html</a>.</p>
</section>

<section>
<header><h2>Install MySQL Driver</h2></header>

<p>Once you have MySQL up and running on your computer, you can access it by using Node.js.
<br><br>
To access a MySQL database with Node.js, you need a MySQL driver. This tutorial will use the "mysql" module, downloaded from NPM.
<br><br>
To download and install the "mysql" module, open the Command Terminal and execute the following:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10/Desktop/my_project</span>$ npm install mysql</div>

<p>Now you have downloaded and installed a mysql database driver.
<br><br>
Node.js can use this module to manipulate the MySQL database:</p>

<div class="syntax" name="node">var mysql = require('mysql');</div>
</section>

<section>
<header><h2>Create Connection</h2></header>
<p>Start by creating a connection to the database.
<br><br>
Use the username and password from your MySQL database.</p>

<div class="syntax" name="node">var mysql = require('mysql');

var con = mysql.createConnection({
  host: "localhost",
  user: "yourusername",
  password: "yourpassword"
});

con.connect(function(err) {
  if (err) throw err;
  console.log("Connected!");
});</div>

<p>You set the host, user and password of your connection when creating it
in MySQL Workbench:</p>

<img style="width: 90%; border: 3px solid black; display: block; margin: auto" src="./../images/node2.JPG">

<p>Save the code above in a file called "demo_db_connection.js" and run the file:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10/Desktop/my_project</span>$ node demo_db_connection.js</div>

<p>When doing that you may get an error, like I did:</p>

<img style="width: 90%; border: 3px solid black; display: block; margin: auto" src="./../images/node1.JPG">

<p>Error: ER_NOT_SUPPORTED_AUTH_MODE: Client does not support authentication protocol requested by server; consider upgrading MySQL client</p>

<p>So, as you can see the authentication protocol is not supported. Let's try to understand why this happens and learn how to fix this.</p>

<section>
  <h2>What's going on?</h2>
  <p class="left">Let's first make it clear what's going on.</p>
  <p class="left">MySQL 8 supports pluggable authentication methods. By default, one of them named <strong>caching_sha2_password</strong> is used rather than our good old <strong>mysql_native_password</strong> (<a href="https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html" target="_blank">source</a>). It should be obvious that using a crypto algorithm with several handshakes is more secure than plain password passing that has been there for 24 years.
<br><br>
Now, the problem is <strong>mysqljs</strong> in Node (the package you install with <strong>npm install mysql</strong> and use it in your Node code) doesn't support this new default authentication method of MySQL 8, yet. The issue is in here: <a href="https://github.com/mysqljs/mysql/issues/1507" target="_blank">https://github.com/mysqljs/mysql/issues/1507</a> and is still open, after 3 years, as of July 2019.</p>
</section>

<section>
<h2>If you just want to get rid of the error, at the cost of risking the security 
of the project (e.g. it's just a personal project or dev environment)</h2>

<p class="left">Execute the following query in MySQL Workbench</p>
<p class="left"><strong>ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';</strong></p>

<p class="left">Where root is your user, localhost is your URL and password is your password</p>

<p class="left">Then run this query to refresh privileges:</p>

<p class="left"><strong>flush privileges;</strong></p>

<p class="left">Try connecting using node after you do so.</p>

<p class="left"><span class="red">If that doesn't work, try it without @'localhost' part.</span></p>
</section>

<section>
<h2>Else, replace "mysql.js" with "mysql2.js" package</h2>
<p>Just install and use mysql2 (instead of mysql) and use it -- <strong>npm install mysql2</strong>, and <strong>mysql = require('mysql2')</strong></p>
</section>

<p>Now you can start querying the database using SQL statements.</p>

</section>

<section>
<header><h2>Query a Database</h2></header>
<p>Use SQL statements to read from (or write to) a MySQL database. This is also called "to query" the database.
<br><br>
The connection object created in the example before, has a method for querying the database:</p>

<div class="syntax" name="node">con.connect(function(err) {
  if (err) throw err;
  console.log("Connected!");
  con.query("SELECT * FROM students", function (err, result) {
    if (err) throw err;
    console.log(JSON.stringify(result, null, 2));
  });
});</div>

<p>I have already made a simple Database named school, with a table
named students, to which I have added 2 rows, we are using
the JSON.stringify method so that the whole object tree is
displayed in the terminal and not just the name of the object.</p>

<p>The JSON.stringify object takes 3 properties:</p>

<dl>
  <dt><strong>value</strong></dt>
  <dd>The value to convert to a JSON string.</dd>
  <dt><strong>replacer (optional)</strong></dt>
  <dd>A function that alters the behavior of the stringification process, or an array of String and Number that serve as an allowlist for selecting/filtering the properties of the value object to be included in the JSON string. If this value is null or not provided, all properties of the object are included in the resulting JSON string</dd>
  <dt><strong> space (optional)</strong></dt>
  <dd>A String or Number object that's used to insert white space (including indentation, line break characters, etc.) into the output JSON string for readability purposes.

    If this is a Number, it indicates the number of space characters to use as white space for indenting purposes; this number is capped at 10 (if it is greater, the value is just 10). Values less than 1 indicate that no space should be used.
    
    If this is a String, the string (or the first 10 characters of the string, if it's longer than that) is used as white space.</dd>
</dl>

<p>Let's try out our code now and see how the object that is returned looks like:</p>

<div class="syntax" name="cmd"><span class="green">karak10@DESKTOP-P0FANNP</span>:<span class="blue">/mnt/c/Users/karak10/Desktop/my_project</span>$ node .\demo_db_connection.js                                                         Connected!
[
  {
    "student_id": 1,
    "first_name": "Jane",
    "last_name": "Doe",
    "age": 17
  },
  {
    "student_id": 2,
    "first_name": "John",
    "last_name": "Doe",
    "age": 32
  }
]</div>

<p>So we got an array of all the rows that were selected, each item of the
array is an object that contains the columns of the row. Here is what the table
looks like if seen inside the MySQL Workbench:</p>

<table class="table">
  <tr>
    <td>student_id</td>
    <td>first_name</td>
    <td>last_name</td>
    <td>age</td>
  </tr>
  <tr>
    <td>1</td>
    <td>Jane</td>
    <td>Doe</td>
    <td>17</td>
  </tr>
  <tr>
    <td>2</td>
    <td>John</td>
    <td>Doe</td>
    <td>32</td>
  </tr>
</table>

<p>We are going to learn more about how to read, write, delete, and update databases in the next chapters.</p>
</section>
</article>


<hr>
</body>
</html>   